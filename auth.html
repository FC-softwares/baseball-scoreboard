<!DOCTYPE html>
<html lang="it">
<head>
    <title>Authentication management</title>
    <input type="hidden" value="0" id="passwd">
    <script>
        const digest = async ({ algorithm = "SHA-256", message }) =>
          Array.prototype.map
            .call(
              new Uint8Array(
                await crypto.subtle.digest(algorithm, new TextEncoder().encode(message))
              ),
              (x) => ("0" + x.toString(16)).slice(-2)
            )
            .join("");
        digest({message: prompt("Enter Password:")})
            .then(ins=>{
              fetch("./passwd.json",{cache: "no-cache"})
              .then(response => response.json())
              .then(obj=>{
                if(obj.includes(ins)){
                  document.getElementById('passwd').value=ins;
                }else{
                  if(confirm("Password incorrect\nTry Again?"))
                    window.location.replace("./auth.html");
                  else 
                    window.location.replace("./index.html");
                }
              })
            })
        function copyToken() {
          let token = document.getElementById("token").value;
          navigator.clipboard.writeText(token);
        }
    </script>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./style_auth.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/gh/zerodevx/zero-md@2/dist/zero-md.min.js"></script>
</head>
<body>
    <div>
        <ul class="header ul-navbar">
            <li id="title" class="li-navbar">Baseball Scoreboard</li>
            <li class="li-navbar"><a href="./index.html" class="link a-navbar">Home</a></li>
            <li class="li-navbar"><a href="./admin.html" class="link a-navbar">Admin</a></li>
            <li class="li-navbar"><a href="./auth.html" class="link active a-navbar">Auth</a></li>
            <li class="li-navbar"><a href="./scoreboard.html" class="link a-navbar" target="_blank">Scoreboard <span class="material-icons" style="font-size: 18px;">open_in_new</span></a></li>
            <li class="li-navbar"><a href="./pregame.html" class="link a-navbar" target="_blank">Pre game <span class="material-icons" style="font-size: 18px;">open_in_new</span></a></li>
            <li class="li-navbar"><a href="./postgame.html" class="link a-navbar" target="_blank">Post game <span class="material-icons" style="font-size: 18px;">open_in_new</span></a></li>
            <li class="li-navbar"><a href="./parz.html" class="link a-navbar" target="_blank">Partials <span class="material-icons" style="font-size: 18px;">open_in_new</span></a></li>
        </ul>
    </div>
    <div class="div-psw">
        <h1>Change Password</h1>
        <form class="form-psw" method="dialog">
            <label for="oldpsw">Old password:</label>
            <input type="password" id="oldpsw" name="oldpsw" required>
            <label for="newpsw">New password:</label>
            <input type="password" id="newpsw" name="newpsw" required>
            <label for="repeatpsw">Repeat new password:</label>
            <input type="password" id="repeatpsw" name="repeatpsw" required>
            <p>Select an option:</p>
            <span>
              <input type="radio" id="opt1" name="opt" value="add" required>
              <label for="opt1">Add password</label>
            </span>
            <span>
              <input type="radio" id="opt2" name="opt" value="replace" required>
              <label for="opt2">Replace</label>
            </span>
            <input type="submit" value="Invia" style="margin: 10px 0px 10px;" onclick="update()">
        </form>
    </div>
    <div class="div-token">
        <h1>Generate Token</h1>
        <div style="display: flex;">
          <input type="text" id="token" name="token" readonly> 
          <button id="copy" onclick="copyToken()" class="material-icons-outlined">
              file_copy
          </button>
        </div>
        <button style="margin: 10px" onclick="update2()">Generate Token</button>
    </div>
</body>
<script src="./auth.js"></script>
</html>