<html>
<head>
    <title>Baseball Scoreboard</title>
    <link rel="stylesheet" href="style_parz.css" type="text/css">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@800&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
</head>
<body>
    <table class="main">
        <tr class="main" id="numbers">
            <td class="void"></td>

        </tr>
        <tr class="main" id="rowA">
            <td class="b" id="colA"><span id="Away">*Away*</span></td>
        </tr>
        <tr class="main" id="rowH">
            <td class="b" id="colH"><span id="Home">*Home*</span></td>
        </tr>
    </table>
    <!-- SCRIPT VARI-->
<script async=false defer=false>
    init()
    function load(){
        fetch("data.json",{cache: "no-cache"})
        .then(response => response.json())
        .then(data =>{
            update(data);
        })
    }
    function update(obj){
        document.getElementById("Away").innerHTML= obj.Away;
        document.getElementById("ScoreA").innerHTML=obj.ScoreA;
        document.getElementById("Away").style="background-color: "+obj.ColorA+"; ";
        document.getElementById("colA").style="background-color: "+obj.ColorA+"; ";
        document.getElementById("Home").innerHTML= obj.Home;
        document.getElementById("ScoreH").innerHTML=obj.ScoreH;
        document.getElementById("Home").style="background-color: "+obj.ColorH+"; ";
        document.getElementById("colH").style="background-color: "+obj.ColorH+"; ";
        fetch("settings.json",{cache:"no-cache"})
        .then(response => response.json())
        .then(set=>{
            for(var i=obj.Ining;i<set.max_inning;i++){
                document.getElementById(i+"A").innerHTML="";
                document.getElementById(i+"A").className="inactive";
                document.getElementById(i+"H").innerHTML="";
                document.getElementById(i+"H").className="inactive";
            }
            for(var i=1;i<=obj.Ining;i++){
                var doifa=0,doifh=0;
                if(i<obj.Ining){
                    document.getElementById(i+"A").innerHTML=obj.int[i].A;
                    document.getElementById(i+"A").className="active";
                    document.getElementById(i+"H").innerHTML=obj.int[i].H;
                    document.getElementById(i+"H").className="active";
                    doifa=1;
                    doifh=1;
                }
                if(i==obj.Ining&&obj.bot==1){
                    document.getElementById(i+"A").innerHTML=obj.int[i].A;
                    document.getElementById(i+"A").className="active";
                    doifa=1;
                }
                if(obj.int[i].H!=0){
                    document.getElementById(i+"H").innerHTML=obj.int[i].H;
                    document.getElementById(i+"H").className="active";
                    doifh=1;
                }
                if(obj.int[i].A!=0){
                    document.getElementById(i+"A").innerHTML=obj.int[i].A;
                    document.getElementById(i+"A").className="active";
                    doifa=1;
                }
                if(doifa==0){
                    document.getElementById(i+"A").innerHTML="";
                    document.getElementById(i+"A").className="inactive";
                }
                if(doifh==0){
                    document.getElementById(i+"H").innerHTML="";
                    document.getElementById(i+"H").className="inactive";
                }
            }
            if((obj.Ining>set.max_inning&&obj.bot==1)||obj.Ining>set.max_inning+1){
                var sA=0,sH=0;
                for(i=set.max_inning;i<=obj.Ining;i++){
                    sA+=obj.int[i].A;
                    sH+=obj.int[i].H;
                }
                document.getElementById("EXA").innerHTML=sA
                document.getElementById("EXH").innerHTML=sH
            }
        })
    }
    window.setInterval(function(){load();}, 500);
    function init(){
        document.getElementById("numbers").innerHTML='<td class="void"></td>';
        document.getElementById("rowA").innerHTML='<td class="b" id="colA"><span id="Away">*Away*</span></td>';
        document.getElementById("rowH").innerHTML='<td class="b" id="colH"><span id="Home">*Home*</span></td>';
        fetch("data.json",{cache:"no-cache"})
        .then(response => response.json())
        .then(data=>{
            fetch("settings.json",{cache:"no-cache"})
            .then(response => response.json())
            .then(set=>{
                for(var i=1;i<=set.max_inning;i++){
                    document.getElementById("numbers").innerHTML+='<td class="numbers" style="text-align:center">'+i+"</td>";
                    if(i<data.Ining||(i==data.Ining&&(data.bot==1||set.dark_current==false)))
                        document.getElementById("rowA").innerHTML+='<td class="active" id="'+i+'A">'+data.int[i].A+'</td>'
                    else{
                        document.getElementById("rowA").innerHTML+='<td class="inactive" id="'+i+'A"></td>'
                    }
                    if(i<data.Ining||(i==data.Ining&&data.bot==1&&set.dark_current==false))
                        document.getElementById("rowH").innerHTML+='<td class="active" id="'+i+'H">'+data.int[i].H+'</td>'
                    else
                        document.getElementById("rowH").innerHTML+='<td class="inactive" id="'+i+'H"></td>'
                }
                if((data.Ining>set.max_inning&&(data.bot==1||data.ScoreA>0))||data.Ining>set.max_inning+1){
                    var sA=0,sH=0;
                    for(i=set.max_inning;i<=data.Ining;i++){
                        sA+=data.int[i].A;
                        sH+=data.int[i].H;
                    }
                    document.getElementById("numbers").innerHTML+='<td class="numbers" style="text-align:center">EX</td>';
                    document.getElementById("rowA").innerHTML+='<td id="EXA" class="active">'+sA+'</td>'
                    document.getElementById("rowH").innerHTML+='<td id="EXH" class="active">'+sH+'</td>'
                }
                document.getElementById("numbers").innerHTML+='<td class="numbers" style="text-align:center">SCORE</td>'
                document.getElementById("rowA").innerHTML+='<td class="b" id="ScoreA">##</td>'
                document.getElementById("rowH").innerHTML+='<td class="b" id="ScoreH">##</td>'
                update(data);
            })
        })
    }
    window.setInterval(function(){init();}, 6000*5);
</script>
</body>
</html>